<div class="dashboard-container">
  <div class="header">
    <h1>Admin Dashboard</h1>
    <button class="logout-btn" (click)="logout()">Logout</button>
  </div>

  <!-- Pending Officer Approvals Section -->
  <div class="card list-card" style="margin-bottom: 20px;">
    <h2>Pending Officer Approvals</h2>
    <table *ngIf="pendingOfficers.length > 0; else noPending">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Assign Department</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let off of pendingOfficers">
          <td>{{ off.fullName }}</td>
          <td>{{ off.email }}</td>
          <td>
            <select [(ngModel)]="off.selectedDept">
              <option value="" disabled selected>Select Dept</option>
              <option value="Roads">Roads</option>
              <option value="Sanitation">Sanitation</option>
              <option value="Electricity">Electricity</option>
              <option value="Water">Water</option>
            </select>
          </td>
          <td>
            <button class="assign-btn" (click)="approveOfficer(off)">Approve</button>
          </td>
        </tr>
      </tbody>
    </table>
    <ng-template #noPending>
      <p>No pending officer requests.</p>
    </ng-template>
  </div>
<!-- All Grievances Section -->
  <div class="card list-card">
    <h2>All Submitted Grievances</h2>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Type</th>
          <th>Description</th>
          <th>Location</th>
          <th>Status</th>
          <th>Priority</th>
          <th>Assign To</th>
          <th>Officer Note</th> <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let g of grievances">
          <td>{{ g.createdAt | date:'shortDate' }}</td>
          <td>{{ g.department }}</td>
          <td>{{ g.description }}</td>
          <td>{{ g.location }}</td>
          <td>
            <span class="status-badge" [ngClass]="g.status.toLowerCase()">
              {{ g.status }}
            </span>
          </td>
          
          <td>
             <span *ngIf="g.status !== 'PENDING'" [ngClass]="'prio-' + g.priority?.toLowerCase()">
               {{ g.priority }}
             </span>
             <select *ngIf="g.status === 'PENDING'" [(ngModel)]="g.selectedPriority">
               <option value="" disabled selected>Set Priority</option>
               <option value="HIGH">High</option>
               <option value="MEDIUM">Medium</option>
               <option value="LOW">Low</option>
             </select>
          </td>

          <td>
             <span *ngIf="g.officer">{{ g.officer.fullName }}</span>
             <select *ngIf="!g.officer" [(ngModel)]="g.selectedOfficerId">
               <option value="" disabled selected>Select Officer</option>
               <option *ngFor="let off of getOfficersByDept(g.department)" [value]="off.id">
                 {{ off.fullName }}
               </option>
               
               <option *ngIf="getOfficersByDept(g.department).length === 0" disabled>
                 No officers in {{ g.department }}
               </option>
             </select>
          </td>

          <td>
            <span *ngIf="g.officerMessage" class="officer-msg" title="{{g.officerMessage}}">
                ðŸ’¬ {{ g.officerMessage }}
            </span>
            <span *ngIf="!g.officerMessage" style="color: #ccc;">-</span>
          </td>

          <td>
            <button *ngIf="g.status === 'PENDING'" class="assign-btn" (click)="assign(g)">
              Assign
            </button>
            <span *ngIf="g.status !== 'PENDING'">âœ… Done</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>